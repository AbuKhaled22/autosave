---
/**
 * FAQSection — renders FAQ accordion with JSON-LD FAQPage schema.
 * Used on programmatic pages for SEO-rich FAQ content and Google rich snippets.
 */
import type { Language } from '../../lib/i18n';

interface FAQ {
  questionAr: string;
  questionEn: string;
  answerAr: string;
  answerEn: string;
}

interface Props {
  faqs: FAQ[];
  lang: Language;
  title?: string;
}

const { faqs, lang, title } = Astro.props;

const sectionTitle =
  title ?? (lang === 'ar' ? 'الأسئلة الشائعة' : 'Frequently Asked Questions');

const faqSchema = {
  '@context': 'https://schema.org',
  '@type': 'FAQPage',
  mainEntity: faqs.map((faq) => ({
    '@type': 'Question',
    name: lang === 'ar' ? faq.questionAr : faq.questionEn,
    acceptedAnswer: {
      '@type': 'Answer',
      text: lang === 'ar' ? faq.answerAr : faq.answerEn,
    },
  })),
};
---

{faqs.length > 0 && (
  <section class="py-20 lg:py-28" data-animate="fade-in-up">
    <div class="mx-auto max-w-3xl px-4 sm:px-6 lg:px-8">
      <div class="mb-10 text-center">
        <span class="eyebrow-decorated text-sm font-semibold uppercase tracking-widest text-primary">
          {lang === 'ar' ? 'أسئلة وأجوبة' : 'FAQ'}
        </span>
        <h2 class="mt-4 font-display text-2xl font-bold text-foreground sm:text-3xl">
          {sectionTitle}
        </h2>
      </div>

      <div class="space-y-3">
        {faqs.map((faq, index) => (
          <details
            class="group rounded-xl border border-border bg-card shadow-sm"
            data-animate="fade-in-up"
            data-animate-delay={String((index + 1) * 100)}
          >
            <summary class="flex min-h-11 cursor-pointer items-center justify-between gap-4 p-4 font-display font-semibold text-foreground sm:p-5 [&::-webkit-details-marker]:hidden">
              <span>{lang === 'ar' ? faq.questionAr : faq.questionEn}</span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="shrink-0 text-primary transition-transform duration-200 group-open:rotate-180"
                aria-hidden="true"
              >
                <polyline points="6 9 12 15 18 9" />
              </svg>
            </summary>
            <div class="faq-answer-wrapper">
              <div class="faq-answer-inner">
                <p class="px-4 pb-4 text-muted-foreground sm:px-5 sm:pb-5">
                  {lang === 'ar' ? faq.answerAr : faq.answerEn}
                </p>
              </div>
            </div>
          </details>
        ))}
      </div>
    </div>

    <script type="application/ld+json" set:html={JSON.stringify(faqSchema)} />
  </section>
)}
